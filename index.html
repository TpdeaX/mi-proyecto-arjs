<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js Geolocation AR Example</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.125.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.125.2/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
    <div id="ar-container"></div>

    <script>
        // Verificar si la API de Geolocalización está disponible
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition((position) => {
                const userLat = position.coords.latitude;
                const userLon = position.coords.longitude;

                // Convertir coordenadas geográficas a coordenadas del mundo 3D
                function latLonToVector3(lat, lon) {
                    const radius = 6371; // Radio de la Tierra en km
                    const phi = (90 - lat) * (Math.PI / 180);
                    const theta = (lon + 180) * (Math.PI / 180);

                    const x = -(radius * Math.sin(phi) * Math.cos(theta));
                    const z = (radius * Math.sin(phi) * Math.sin(theta));
                    const y = (radius * Math.cos(phi));

                    return new THREE.Vector3(x, y, z);
                }

                const targetLat = -8.37849779208289;
                const targetLon = -74.55073339670564;
                const targetPosition = latLonToVector3(targetLat, targetLon);

                // Configurar la escena de Three.js
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.getElementById('ar-container').appendChild(renderer.domElement);

                // Cargar el modelo GLB
                const loader = new THREE.GLTFLoader();
                loader.load('assets/asset.glb', (gltf) => {
                    const model = gltf.scene;
                    model.position.copy(targetPosition);
                    scene.add(model);
                });

                camera.position.set(0, 0, 10);

                // Animar la escena
                function animate() {
                    requestAnimationFrame(animate);
                    renderer.render(scene, camera);
                }
                animate();
            }, (error) => {
                console.error("Error al obtener la geolocalización: ", error);
            });
        } else {
            console.error("La API de Geolocalización no está disponible en este navegador.");
        }
    </script>
</body>
</html>
