<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ar-js-org/ar.js/aframe/build/aframe-ar-nft.min.js"></script>
  </head>
  <body>
    <a-scene
      embedded
      loading-screen="enabled: false;"
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-assets timeout="10000" id="assets-container">
        <!-- Los modelos se cargarán dinámicamente aquí -->
      </a-assets>

      <a-camera id="camera" gps-camera rotation-reader></a-camera>
    </a-scene>

    <!-- ComboBox para seleccionar cámara -->
    <select id="camera-selector">
      <option value="0">Cámara trasera</option>
      <option value="1">Cámara delantera</option>
    </select>

    <script>
      async function loadModels() {
        try {
          const response = await fetch("models.json"); 
          const models = await response.json();

          const assetsContainer = document.querySelector("#assets-container");
          const scene = document.querySelector("a-scene");

          models.forEach((item) => {
            const asset = document.createElement("a-asset-item");
            asset.setAttribute("id", item.id);
            asset.setAttribute("src", item.src);
            assetsContainer.appendChild(asset);

            const entity = document.createElement("a-entity");
            entity.setAttribute("gltf-model", `#${item.id}`);
            entity.setAttribute(
              "gps-entity-place",
              `latitude: ${item.latitude}; longitude: ${item.longitude};`
            );
            entity.setAttribute("scale", item.scale);
            scene.appendChild(entity);
          });
        } catch (error) {
          console.error("Error al cargar los modelos:", error);
        }
      }

      // Función para enumerar las cámaras disponibles
      function enumerateCameras() {
        navigator.mediaDevices.enumerateDevices().then(devices => {
          const videoDevices = devices.filter(device => device.kind === 'videoinput');
          const selector = document.getElementById("camera-selector");

          // Limpiar las opciones previas
          selector.innerHTML = '';

          // Añadir las cámaras disponibles al combo
          videoDevices.forEach((device, index) => {
            const option = document.createElement("option");
            option.value = index;
            option.text = device.label || `Cámara ${index + 1}`;
            selector.appendChild(option);
          });

          // Asignar la cámara por defecto
          selector.value = 0;
        });
      }

      // Función para cambiar la cámara al seleccionar una nueva opción
      function switchCamera() {
        const selectedCameraIndex = document.getElementById("camera-selector").value;
        
        // Aquí se puede hacer que se recargue la página para cambiar la cámara seleccionada
        window.location.reload();
      }

      // Detecta las cámaras disponibles y asigna el evento al selector
      enumerateCameras();
      document.getElementById("camera-selector").addEventListener("change", switchCamera);

      loadModels();
    </script>
  </body>
</html>
