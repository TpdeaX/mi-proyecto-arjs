<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ar-js-org/ar.js/aframe/build/aframe-ar-nft.min.js"></script>
    <style>
      #switchCamera {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
        padding: 10px;
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid #000;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <button id="switchCamera" onclick="toggleCamera()">Cambiar Cámara</button>

    <script>
      // Configurar la cámara basado en el parámetro de URL
      function setupScene() {
        const urlParams = new URLSearchParams(window.location.search);
        const cameraType = urlParams.get('camera');
        const facingMode = cameraType === 'front' ? 'user' : 'environment';

        const scene = document.createElement('a-scene');
        scene.setAttribute('embedded', '');
        scene.setAttribute('loading-screen', 'enabled: false;');
        scene.setAttribute('arjs', 
          `sourceType: webcam; 
          sourceUrl: video?facingMode=${facingMode}; 
          debugUIEnabled: false;`);

        const assets = document.createElement('a-assets');
        assets.setAttribute('timeout', '10000');
        assets.setAttribute('id', 'assets-container');
        
        const camera = document.createElement('a-camera');
        camera.setAttribute('gps-camera', '');
        camera.setAttribute('rotation-reader', '');

        scene.appendChild(assets);
        scene.appendChild(camera);
        document.body.appendChild(scene);

        loadModels();
      }

      async function loadModels() {
        try {
          const response = await fetch("models.json");
          const models = await response.json();
          const assetsContainer = document.querySelector("#assets-container");
          const scene = document.querySelector("a-scene");

          models.forEach((item) => {
            const asset = document.createElement("a-asset-item");
            asset.setAttribute("id", item.id);
            asset.setAttribute("src", item.src);
            assetsContainer.appendChild(asset);

            const entity = document.createElement("a-entity");
            entity.setAttribute("gltf-model", `#${item.id}`);
            entity.setAttribute(
              "gps-entity-place",
              `latitude: ${item.latitude}; longitude: ${item.longitude};`
            );
            entity.setAttribute("scale", item.scale);
            scene.appendChild(entity);
          });
        } catch (error) {
          console.error("Error al cargar los modelos:", error);
        }
      }

      function toggleCamera() {
        const urlParams = new URLSearchParams(window.location.search);
        const currentCamera = urlParams.get('camera');
        
        if (currentCamera === 'front') {
          urlParams.delete('camera');
        } else {
          urlParams.set('camera', 'front');
        }
        
        // Recargar la página con los nuevos parámetros
        window.location.search = urlParams.toString();
      }

      // Inicializar la escena cuando el documento esté listo
      document.addEventListener('DOMContentLoaded', setupScene);
    </script>
  </body>
</html>
